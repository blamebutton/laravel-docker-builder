#!/usr/bin/env bash

source .env

PACKAGE="$(dirname "${BASH_SOURCE[0]}")/.."

if ! [[ -f "${PWD}/public/index.php" ]]; then
  echo "Missing [/public/index.php], please run from Laravel base directory.";
  exit 1
fi

if ! [[ -f "${PWD}/.dockerignore" ]]; then
  echo "Missing [/.dockerignore], copying...";
  cp "${PACKAGE}/docker/.dockerignore" "${PWD}/.dockerignore"
fi

NGINX_TAG="${DOCKER_NGINX_TAG}"
PHP_TAG="${DOCKER_PHP_TAG}"

if [[ -z "${NGINX_TAG}" ]]; then
  echo "Environment variable [DOCKER_NGINX_TAG] not found."
  exit 1
fi

if [[ -z "${PHP_TAG}" ]]; then
  echo "Environment variable [DOCKER_PHP_TAG] not found."
  exit 1
fi

echo "Building [${NGINX_TAG}]"
docker build \
  --tag "${NGINX_TAG}" \
  --file "${PWD}/.docker/nginx.dockerfile" \
  "${PWD}"

echo "Building [${PHP_TAG}]"
docker build \
  --tag "${PHP_TAG}" \
  --file "${PWD}/.docker/php.dockerfile" \
  "${PWD}"